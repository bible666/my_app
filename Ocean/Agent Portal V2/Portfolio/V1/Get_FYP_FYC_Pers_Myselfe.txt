APUI05_01_Get_FYP_FYC_Pers_Myselfe
Skip to end of metadata
Added by วิรัตน์ มหาศาลประเสริฐ, last edited by วิรัตน์ มหาศาลประเสริฐ on Feb 08, 2018  (view change)Go to start of metadata
TOC

[ Objectives ] [ Process Overview ] [ Preconditions ] [ Process Description ] [ Post-conditions ]
Objectives
ดึงข้อมูล FYP, FYC และ Persistency ส่วนตัว ตาม agent code, branch_code, period และ position_group ที่ได้รับมา
 

Process Overview
ดึงข้อมูล FYP, FYC และ Persistency ส่วนตัว ในฐานข้อมูล ตาม agent code, branch_code, period และ position_group ที่ได้รับมา
 

Preconditions
รับค่า agent code, branch_code, period และ position_group เข้ามา
 

Process Description
ถ้า agent code, branch_code และ period ที่ได้รับมานั้น มี position_group = "ผจภ.สข." ให้ใช้ SQL ดังนี้ (ไม่ต้องทำต่อข้อ 2.)
Icon
select	a.premium_portfolio as fyp, a.commission_first as fyc, b.supervisor_persistency as persistency
from		agpt_agent_income a
left outer join	agpt_persistency_summary b
on		a.period = b.period
	and	a.branch_code = b.branch_code
	and	a.agent_code_7 = b.supervisor_code_7
where	a.period = v_period
	and	a.branch_code = v_branch_code
	and	a.agent_code_7 = v_agent_code	
group by	a.agent_code_7, a.premium_portfolio, a.commission_first, b.supervisor_persistency;
     

ถ้า agent code, branch_code และ period ที่ได้รับมานั้น มี position_group = "ผจก.หน่วย" ให้ใช้ SQL ดังนี้ (ไม่ต้องทำต่อข้อ 3.) 
Icon
select	a.premium_portfolio as fyp, a.commission_first as fyc, b.supervisor_persistency as persistency
from		agpt_agent_income a
left outer join	agpt_persistency_summary b
on		a.period = b.period
	and	a.branch_code = b.branch_code
	and	a.agent_code_7 = b.supervisor_code_7
where	a.period = v_period
	and	a.branch_code = v_branch_code
	and	a.agent_code_7 = v_agent_code	
group by	a.agent_code_7, a.premium_portfolio, a.commission_first, b.supervisor_persistency;
     

[Phase 2 - add] ถ้า agent code, branch_code และ period ที่ได้รับมานั้น มี position_group = "ผช.ผจก.หน่วย" ให้ใช้ SQL ดังนี้ (ไม่ต้องทำต่อข้อ 4.)
Icon
select	a.agent_code_7 as agent_code_7, 
		a.premium_portfolio as fyp, a.commission_first as fyc, b.supervisor_persistency as persistency
from		agpt_agent_income a
left outer join	agpt_persistency_summary b
on		a.period = b.period
	and	a.branch_code = b.branch_code
	and	a.agent_code_7 = b.supervisor_code_7
where	a.period = v_period
	and	a.branch_code = v_branch_code
	and	a.agent_code_7 = v_agent_code	
group by	a.agent_code_7, a.premium_portfolio, a.commission_first, b.supervisor_persistency;
     

ถ้า agent code, branch_code และ period ที่ได้รับมานั้น มี position_group = "หนน." ให้ใช้ SQL ดังนี้ (ไม่ต้องทำต่อข้อ 5.)
Icon
select	a.premium_portfolio as fyp, a.commission_first as fyc, b.supervisor_persistency as persistency
from		agpt_agent_income a
left outer join	agpt_persistency_summary b
on		a.period = b.period
	and	a.branch_code = b.branch_code
	and	a.agent_code_7 = b.supervisor_code_7
where	a.period = v_period
	and	a.branch_code = v_branch_code
	and	a.agent_code_7 = v_agent_code	
group by	a.agent_code_7, a.premium_portfolio, a.commission_first, b.supervisor_persistency;
     

ถ้า agent code, branch_code และ period ที่ได้รับมานั้น มี position_group in ("ตท.", "ตท.กง.") อย่างใดอย่างหนึ่ง ให้ใช้ SQL ดังนี้ (ไม่ต้องทำต่อข้อ 6.)
Icon
select	a.premium_portfolio as fyp, a.commission_first as fyc, b.agent_persistency as persistency
from		agpt_agent_income a
left outer join	agpt_persistency_summary b
on		a.period = b.period
	and	a.branch_code = b.branch_code
	and	a.agent_code_7 = b.agent_code_7
where	a.period = v_period
	and	a.branch_code = v_branch_code
	and	a.agent_code_7 = v_agent_code;
     

ถ้าได้ค่าเป็น null ให้ return ค่าเป็น
- fyp = 0.00
- fyc = 0.00
- persistency = 0.00

 

Post-conditions
ทำการ return ข้อมูล FYP, FYC และ Persistency ส่วนตัว ทั้งหมด 3 fields คือ 
- fyp
- fyc
- persistency