APUI08_01_Get_Period_for_download_Slip
Skip to end of metadata
Added by วิรัตน์ มหาศาลประเสริฐ, last edited by วิรัตน์ มหาศาลประเสริฐ on Jan 05, 2018  (view change)Go to start of metadata
TOC

[ Objectives ] [ Process Overview ] [ Preconditions ] [ Process Description ] [ Post-conditions ]
Objectives
ดึง  Period, ช่วงเวลา และ flag เพื่อให้ระบบทราบว่าสามารถ download Slip ได้
 

Process Overview
ดึง  Period, ช่วงเวลา และ flag จากฐานข้อมูล แล้วนำมาแสดงเป็นข้อความบนหน้าจอ Download พร้อมทั้งควบคุมปุ่ม Download ให้ Enabled หรือ Disabled ตาม flag ที่ได้
 

Preconditions
รับค่า Period เข้ามา
 

Process Description
ให้ get Period, ช่วงเวลา และ flag จาก Query นี้
Icon
select	b.period,
		case
			when	a.start_date <= current_date and current_date < b.payment_date then
				' [ กรุณารอ ระบบจะเปิดให้ download ในช่วงวันที่ '||substr(to_char(b.payment_date,'dd/mm/yyyy'),1,6)||(substr(to_char(b.payment_date,'dd/mm/yyyy'),7,4)::numeric + 543)
				||' - '||substr(to_char(a.end_date,'dd/mm/yyyy'),1,6)||(substr(to_char(a.end_date,'dd/mm/yyyy'),7,4)::numeric + 543)||' ]'
			when	b.payment_date <= current_date and current_date <= a.end_date then
				' [ สามารถ download ได้ ('||substr(to_char(b.payment_date,'dd/mm/yyyy'),1,6)||(substr(to_char(b.payment_date,'dd/mm/yyyy'),7,4)::numeric + 543)
				||' - '||substr(to_char(a.end_date,'dd/mm/yyyy'),1,6)||(substr(to_char(a.end_date,'dd/mm/yyyy'),7,4)::numeric + 543)||') ]'
		end duration_date,
		case
			when	a.start_date <= current_date and current_date < b.payment_date then
				'N'
			when	b.payment_date <= current_date and current_date <= a.end_date then
				'Y'
		end flag, b.ppyy
from		(
			select	current_date as current_date, (start_date - interval '1 day') :: date as previous_start_date,
					period, start_date, end_date, payment_date
			from		agpt_period
			where	start_date <= current_date
				and	end_date >= current_date
		) a
inner join	agpt_period b
on		a.previous_start_date = b.end_date;	
     

Post-conditions
ทำการ return ข้อมูลทั้งหมด 4 fields คือ 
- period
- duration_date
- flag
- ppyy