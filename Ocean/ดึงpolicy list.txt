/thaisamut/policy/v3/xml/inquiry/searchbyagent#searchPolicyDetail
Skip to end of metadata
Added by อนุชา โพธิ์ทรง, last edited by วิรัตน์ มหาศาลประเสริฐ on May 28, 2018  (view change)Go to start of metadata
[ Overview ] [ Protocol ] [ Operation ] [ Input ] [ Process ] [ Output ] [ Exception ] [ Example Input & Output ]
 

Overview
ดึงรายละเอียด กธ. ตามรหัสตัวแทน และเงื่อนไขต่าง ๆ ที่ส่งมา โดยดึงข้อมูลจาก Datawarehouse (DWCONSOL) และ return ข้อมูลให้แบบ paging

Protocol
Icon
<SOAP,HESSIAN,REST>

Operation
refer : ESB WebService Design Pattern

Icon
TYPE : <inquiry,bulk,delete,update,add>

searchPolicyDetail

Input
Name
Type
Description
Example
Mandatory
Validation
agentCode7Digit    Integer    รหัสตัวแทน 7 หลัก         Y     
startPayTo    Date    เริ่มวันที่ชำระถึง               
endPayTo    Date    สิ้นสุดวันที่ชำระถึง               
policyStatus    String    สถานะกรมธรรม์

           
policyType
PolicyType
O = สามัญ 
I = ปช
G = ขพ

P = PA

           
fieldOrder    OrderBy    
Enum OrderBy:
POLICY_TYPE,
PAT_TO,
POLICY_NO,
BASE_PREMIUM_AMOUNT,
FIRST_NAME,
LAST_NAME,
PROVINCE,
BASE_SUM_ASSURED,
RIDER_FLAG,

           
sort    Sort    
enum Sort:

ASC,
DESC

           
offset    Integer    ลำดับข้อมูลแรกที่ต้องการดึงข้อมูล จากการทำ paging               
limit    Integer    ปริมาณข้อมูลที่ต้องการดึงข้อมูลต่อ 1 page               
Process
ดึงข้อมูลกรมธรรม์สามัญ

select  a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name1 as product_name, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc,a.first_name,a.last_name, a.age_at_comm_date,
        a.mobile1 as mobile, d.province_name, a.agent_code,
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end as rider_flag
from        ili_policy_master a
left outer join ili_product_ord b
on      a.product_code = b.prd_code   
left outer join ili_rider_master c 
on      a.policy_no = c.policy_no and c.rider_code <> '6'
left outer join ili_policy_address d
on      a.policy_no = d.policy_no and address_type = '2'
where   a.agent_code = ?  
and a.policy_type in (?) 
and (a.pay_to >= ? and a.pay_to < ?)
and a.policy_status = ?
group by    a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name1, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc, a.first_name, a.last_name, a.age_at_comm_date, 
        a.mobile1, d.province_name, a.agent_code, 
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end
order by policy_no asc/desc offset ? limit ? 
ข้อมูลสัญญาเพิ่มเติมสามัญ

select  a.policy_type, a.policy_no, a.rider_code, (b.rider_abbr_name2||' - '||b.rider_name) as rider_name, 
        a.sum_assured as rider_sum_assured, a.premium_amount as rider_premium_amount, 
        a.extra_premium as rider_extra_premium
from  ili_rider_master a 
left outer join ili_product_rider_ord b
on      a.rider_code = cast(b.rider_code as varchar)
where a.policy_no in (?) and a.rider_code <> '6'
ดึงข้อมูลกรมธรรม์อุตสาหกรรม

select  a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name as product_name, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc,a.first_name,a.last_name, a.age_at_comm_date,
        a.mobile1 as mobile, d.province_name, a.agent_code,
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end as rider_flag
from        ili_policy_master a
left outer join ili_product_ind b
on      a.product_code = b.prd_code   
left outer join ili_rider_master c
on      a.policy_no = c.policy_no  
left outer join ili_policy_address d
on      a.policy_no = d.policy_no and address_type = '2'
where   a.agent_code = ? 
and a.policy_type in (?) 
and (a.pay_to >= ? and a.pay_to < ?)
and a.policy_status = ?
group by    a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc, a.first_name, a.last_name, a.age_at_comm_date, 
        a.mobile1, d.province_name, a.agent_code, 
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end
order by policy_no asc/desc offset ? limit ?  
ข้อมูลสัญญาเพิ่มเติมอุตสาหกรรม

select  a.policy_type, a.policy_no, a.rider_code, b.rider_name, 
        a.sum_assured as rider_sum_assured, 
        a.premium_amount as rider_premium_amount, 
        a.extra_premium as rider_extra_premium
from  ili_rider_master a 
left outer join ili_product_rider_ind b
on      a.rider_code = cast(b.rider_code as varchar)
where a.policy_no in (?)
ดึงข้อมูลกรมธรรม์ PA

select  a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name as product_name, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc,a.first_name,a.last_name, a.age_at_comm_date,
        a.mobile1 as mobile, d.province_name, a.agent_code,
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end as rider_flag
from        ili_policy_master a
left outer join ili_product_pa b
on      a.product_code = b.prd_code   
left outer join ili_rider_master c
on      a.policy_no = c.policy_no  
left outer join ili_policy_address d
on      a.policy_no = d.policy_no and address_type = '2'
where   a.agent_code = ?  
and a.policy_type in (?) 
and (a.pay_to >= ? and a.pay_to < ?)
and a.policy_status = ?
group by    a.policy_type, a.pay_to, a.policy_no, a.policy_year, a.policy_status, 
        a.product_code, b.prd_name, b.coverage_term, b.payment_term,
        a.sum_assured, a.premium_amount, a.extra_premium, a.payment_mode, 
        a.payment_channel, a.commencement_date, a.maturity_date, 
        a.title_desc, a.first_name, a.last_name, a.age_at_comm_date, 
        a.mobile1, d.province_name, a.agent_code, 
        case when c.policy_no is null then cast('N' as varchar)
        else cast('Y' as varchar) end
order by policy_no asc/desc offset ? limit ?  
ข้อมูลสัญญาเพิ่มเติม PA

select 
        a.policy_type, a.policy_no, a.rider_code, b.rider_name, 
        a.sum_assured as rider_sum_assured, a.premium_amount as rider_premium_amount, 
        a.extra_premium as rider_extra_premium
from  ili_rider_master a 
left outer join ili_product_rider_pa b
on a.rider_code = b.benefit_code
where a.policy_no in (?)
Output
<แสดงข้อมูลที่จะได้รับจาก service นี้>

     Name    Type    Description    Example
ArrayList              EMPTY เมื่อไม่มีข้อมูล     
     
policyType
PolicyType
ประเภทกรมธรรม์
O = สามัญ 
I = ปช
G = ขพ

P = PA

 
     
policyNo
String     เลขที่กรมธรรม์     
     
policyStatus
String    สถานะกรมธรรม์     
     policyYear    BigDecimal    ปีกรมธรรม์     
     payTo    Date    วันที่ชำระถึง     
     
planCode
String    รหัสแบบประกัน     
     
planName
String    ชื่อแบบประกัน     
     
sumAssured
BigDecimal    ทุนประกันหลัก     
     
premiumAmount
BigDecimal    เบี้ยประกันหลัก     
     
extraPremium
BigDecimal    เบี้ยพิเศษหลัก     
     
coverageTerm
Integer    ระยะเวลาประกัน     
     
paymentTerm
Integer    ระยะเวลาชำระเบี้ย     
     commencementDate    Date    วันที่เริ่มสัญญา     
     maturityDate    Date    วันที่สิ้นสุดสัญญา     
     paymentMode    Integer    โหมดการชำระ     
     paymentChannel    Channel    
ช่องทางที่ลูกค้าเลือกชำระเงิน

UNKNOWN("","ไม่รู้จักสถานะนี้"),
NA("0", "ไม่ระบุ"),
CASH("1", "เงินสด"),
BANK_TRANSFER("2", "โอนเงิน"),
CHEQUE("3", "เช็ค"),
DIRECT_DEBIT("4", "หักบัญชีเงินฝาก"),
AGENCIES("5","ผ่านหน่วยงานต้นสังกัด"),
UNSPECIFIED("6", "ไม่ระบุ"),
BANCASSURENCE("7", "Bancassurence"),
INTERNET_BANKING("8", "Internet Banking"),
AUTO_CREDIT("9", "หักบัตรเครดิต"),
BIZ_PAYMENT("A", "Biz Payment")

 
     paymentChannelCode    String    รหัสช่องทางที่ลูกค้าเลือกชำระเงิน     
     paymentChannelDesc    String    คำอธิบายช่องทางที่ลูกค้าเลือกชำระเงิน     
     insureTitle    String    คำนำหน้า     
     insureName    String    ชื่อ     
     insureSurname    String    สกุล     
     insureAgeAsOf    String    อายุลูกค้า ณ ตอนทำกรมธรรม์     
     insureMobileNo    String    เบอร์มือถือ ลูกค้า     
     insureProvinceName    String    จังหวัด ตามที่อยู่ที่ติดต่อ ของลูกค้า     
     agentCode    String    หรัสตัวแทน 7 หลัก     
     riderFlag    Boolean    TRUE,FaLSE     
ข้อมูล Rider
ArrayList              EMPTY เมื่อไม่มีค่า     
     
policyType
PolicyType
ประเภทกรมธรรม์
O = สามัญ 
I = ปช
G = ขพ

P = PA

 
     
policyNo
String     เลขที่กรมธรรม์     
     riderCode    String    รหัสสัญญาเพิ่มเติม     
     riderName    String    ชื่อสัญญาเพิ่มเติม     
     
sumAssured
BigDecimal    ทุนประกันหลัก     
     
premiumAmount
BigDecimal    เบี้ยประกันหลัก     
     
extraPremium
BigDecimal    เบี้ยพิเศษหลัก     
Exception
<อธิบายว่า มี exception อะไรที่ต้องจัดการหรือระวังบ้าง>

Example Input & Output
<ตัวอย่างที่ 1 เช่น การส่งข้อมูลแบบปกติ>
<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <searchPolicyDetail xmlns="http://v3.searchbyagent.policyws.targetbundles.osgi.thaisamut/">
            <agentCode7Digit xmlns="">3401793</agentCode7Digit>
            <startPayTo xmlns="">2018-01-01</startPayTo>
            <endPayTo xmlns="">2018-02-01</endPayTo>
            <policyType xmlns="">O</policyType>
            <!--<policyStatus xmlns="">[string?]</policyStatus>-->
            <fieldOrder xmlns="">POLICY_NO</fieldOrder>
            <sort xmlns="">ASC</sort>
            <offset xmlns="">0</offset>
            <limit xmlns="">20</limit>
        </searchPolicyDetail>
    </Body>
</Envelope>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <ns2:searchPolicyDetailResponse xmlns:ns2="http://v3.searchbyagent.policyws.targetbundles.osgi.thaisamut/">
            <return>
                <policyNo>0177045</policyNo>
                <policyType>O</policyType>
                <payTo>2018-01-14T00:00:00+07:00</payTo>
                <policyYear>15</policyYear>
                <policyStatus>I</policyStatus>
                <planCode>031</planCode>
                <planName>สะสมทรัพย์ ครบกำหนดอายุ 60 ปี</planName>
                <coverageTerm>60</coverageTerm>
                <paymentTerm>15</paymentTerm>
                <commencementDate>2003-01-15T00:00:00+07:00</commencementDate>
                <maturityDate>2056-01-15T00:00:00+07:00</maturityDate>
                <paymentMode>12</paymentMode>
                <paymentChannel>UNKNOWN</paymentChannel>
                <paymentChannelCode></paymentChannelCode>
                <paymentChannelDesc>ไม่รู้จักสถานะนี้</paymentChannelDesc>
                <sumAssured>100000.0000</sumAssured>
                <premiumAmount>1651.0000</premiumAmount>
                <extraPremium>0.0000</extraPremium>
                <insureTitle>ด.ช.</insureTitle>
                <insureName>รักรณพร</insureName>
                <insureSurname>แสนสำแดง</insureSurname>
                <insureAgeAsOf>7</insureAgeAsOf>
                <insureProvinceName>นครราชสีมา</insureProvinceName>
                <agentCode>3401793</agentCode>
                <riderFlag>false</riderFlag>
            </return>
            <return>
                <policyNo>0767384</policyNo>
                <policyType>O</policyType>
                <payTo>2018-01-03T00:00:00+07:00</payTo>
                <policyYear>6</policyYear>
                <policyStatus>I</policyStatus>
                <planCode>084</planCode>
                <planName>เพื่อนคู่ชีวิต</planName>
                <coverageTerm>20</coverageTerm>
                <paymentTerm>15</paymentTerm>
                <commencementDate>2012-01-04T00:00:00+07:00</commencementDate>
                <maturityDate>2032-01-04T00:00:00+07:00</maturityDate>
                <paymentMode>12</paymentMode>
                <paymentChannel>UNKNOWN</paymentChannel>
                <paymentChannelCode></paymentChannelCode>
                <paymentChannelDesc>ไม่รู้จักสถานะนี้</paymentChannelDesc>
                <sumAssured>300000.0000</sumAssured>
                <premiumAmount>17562.0000</premiumAmount>
                <extraPremium>0.0000</extraPremium>
                <insureTitle>นาย</insureTitle>
                <insureName>ฉัตรชัย</insureName>
                <insureSurname>พิลาวรรณ์</insureSurname>
                <insureAgeAsOf>41</insureAgeAsOf>
                <insureProvinceName>นครราชสีมา</insureProvinceName>
                <agentCode>3401793</agentCode>
                <riderFlag>true</riderFlag>
                <riders>
                    <policyNo>0767384</policyNo>
                    <policyType>O</policyType>
                    <riderCode>19</riderCode>
                    <riderName>CPA.2.6* - คุ้มครองอุบัติเหตุพิเศษ</riderName>
                    <sumAssured>100000.0000</sumAssured>
                    <premiumAmount>308.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
                <riders>
                    <policyNo>0767384</policyNo>
                    <policyType>O</policyType>
                    <riderCode>6</riderCode>
                    <riderName>WP - การยกเว้นชำระเบี้ยประกัน</riderName>
                    <sumAssured>300000.0000</sumAssured>
                    <premiumAmount>0.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
            </return>
            <return>
                <policyNo>1319770</policyNo>
                <policyType>O</policyType>
                <payTo>2018-01-19T00:00:00+07:00</payTo>
                <policyYear>2</policyYear>
                <policyStatus>I</policyStatus>
                <planCode>218</planCode>
                <planName>สบายชัวร์</planName>
                <coverageTerm>25</coverageTerm>
                <paymentTerm>15</paymentTerm>
                <commencementDate>2016-01-20T00:00:00+07:00</commencementDate>
                <maturityDate>2041-01-20T00:00:00+07:00</maturityDate>
                <paymentMode>12</paymentMode>
                <paymentChannel>CASH</paymentChannel>
                <paymentChannelCode>1</paymentChannelCode>
                <paymentChannelDesc>เงินสด</paymentChannelDesc>
                <sumAssured>300000.0000</sumAssured>
                <premiumAmount>30000.0000</premiumAmount>
                <extraPremium>0.0000</extraPremium>
                <insureTitle>นาย</insureTitle>
                <insureName>อธิก</insureName>
                <insureSurname>พาผักแว่น</insureSurname>
                <insureAgeAsOf>47</insureAgeAsOf>
                <insureProvinceName>นนทบุรี</insureProvinceName>
                <agentCode>3401793</agentCode>
                <riderFlag>true</riderFlag>
                <riders>
                    <policyNo>1319770</policyNo>
                    <policyType>O</policyType>
                    <riderCode>19</riderCode>
                    <riderName>CPA.2.6* - คุ้มครองอุบัติเหตุพิเศษ</riderName>
                    <sumAssured>300000.0000</sumAssured>
                    <premiumAmount>924.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
                <riders>
                    <policyNo>1319770</policyNo>
                    <policyType>O</policyType>
                    <riderCode>25</riderCode>
                    <riderName>DAB2 - ค่าชดเชยรายได้รายวัน</riderName>
                    <sumAssured>1000.0000</sumAssured>
                    <premiumAmount>1300.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
                <riders>
                    <policyNo>1319770</policyNo>
                    <policyType>O</policyType>
                    <riderCode>6</riderCode>
                    <riderName>WP - การยกเว้นชำระเบี้ยประกัน</riderName>
                    <sumAssured>300000.0000</sumAssured>
                    <premiumAmount>0.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
            </return>
            <return>
                <policyNo>1319772</policyNo>
                <policyType>O</policyType>
                <payTo>2018-01-19T00:00:00+07:00</payTo>
                <policyYear>2</policyYear>
                <policyStatus>I</policyStatus>
                <planCode>191</planCode>
                <planName>เพื่อนคู่ชีวิต B450 (20/15)</planName>
                <coverageTerm>20</coverageTerm>
                <paymentTerm>15</paymentTerm>
                <commencementDate>2016-01-20T00:00:00+07:00</commencementDate>
                <maturityDate>2036-01-20T00:00:00+07:00</maturityDate>
                <paymentMode>12</paymentMode>
                <paymentChannel>UNKNOWN</paymentChannel>
                <paymentChannelCode></paymentChannelCode>
                <paymentChannelDesc>ไม่รู้จักสถานะนี้</paymentChannelDesc>
                <sumAssured>150000.0000</sumAssured>
                <premiumAmount>9294.0000</premiumAmount>
                <extraPremium>0.0000</extraPremium>
                <insureTitle>น.ส.</insureTitle>
                <insureName>สมเฉลา</insureName>
                <insureSurname>สิงห์ลี</insureSurname>
                <insureAgeAsOf>54</insureAgeAsOf>
                <insureProvinceName>นครราชสีมา</insureProvinceName>
                <agentCode>3401793</agentCode>
                <riderFlag>true</riderFlag>
                <riders>
                    <policyNo>1319772</policyNo>
                    <policyType>O</policyType>
                    <riderCode>19</riderCode>
                    <riderName>CPA.2.6* - คุ้มครองอุบัติเหตุพิเศษ</riderName>
                    <sumAssured>300000.0000</sumAssured>
                    <premiumAmount>924.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
                <riders>
                    <policyNo>1319772</policyNo>
                    <policyType>O</policyType>
                    <riderCode>25</riderCode>
                    <riderName>DAB2 - ค่าชดเชยรายได้รายวัน</riderName>
                    <sumAssured>1000.0000</sumAssured>
                    <premiumAmount>1300.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
                <riders>
                    <policyNo>1319772</policyNo>
                    <policyType>O</policyType>
                    <riderCode>6</riderCode>
                    <riderName>WP - การยกเว้นชำระเบี้ยประกัน</riderName>
                    <sumAssured>150000.0000</sumAssured>
                    <premiumAmount>0.0000</premiumAmount>
                    <extraPremium>0.0000</extraPremium>
                </riders>
            </return>
        </ns2:searchPolicyDetailResponse>
    </soap:Body>
</soap:Envelope>