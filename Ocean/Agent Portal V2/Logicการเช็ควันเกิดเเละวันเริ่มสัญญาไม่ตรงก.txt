แยกเป็น 3 กรณี เชควันเกิดไม่ตรงกัน
กรณีที่ 1
 ถ้า temp_commencement_date_v5 หรือ  commencement_date_400  เช็คเเล้วเกิน วันที่ 1 ม.ค. ปี 55 
 ให้เช็คว่า age_nbs =  ปีของวันเริ่มสัญญา(temp_commencement_date_v5 )- ปีของวันเกิด(temp_birthdate_v21 )
 ให้เช็คว่า age_at_comm_400 =  ปีของวันเริ่มสัญญา(commencement_date_400 )- ปีของวันเกิด(cust_birthdate_400)

กรณีที่ 2

 ถ้า temp_commencement_date_v5 หรือ  commencement_date_400  เช็คเเล้วก่อน วันที่ 1 ม.ค. ปี 55 

*****ถ้าMM เกิน 6 เดือน ให้ เป็น ปี + 1

 ให้เช็คว่า age_nbs =  ปีของวันเริ่มสัญญา(temp_commencement_date_v5 )- ปีของวันเกิด(temp_birthdate_v21 )
 ให้เช็คว่า age_at_comm_400 =  ปีของวันเริ่มสัญญา(commencement_date_400 )- ปีของวันเกิด(cust_birthdate_400)


กรณีที่ 3

 ถ้า temp_commencement_date_v5 หรือ  commencement_date_400  เช็คเเล้วก่อน ปี2483
 ให้เช็คว่า age_nbs default เป็นวันที่ 1 มค. 
 ให้เช็คว่า age_at_comm_400 default เป็นวันที่ 1 มค. 


*****************************************************

select chk.policy_no_v2 , chk.branch_code ,chk.tmp_group_policy_status,
       chk.temp_birthdate_v21,chk.cust_birthdate_400,
       chk.temp_commencement_date_v5 , chk.commencement_date_400 ,
       chk.age_nbs,chk.age_at_comm_400,age_nbs_check_more55YY ,age_as400_check_more55YY, age_nbs_check_less55YYmore6MM + 1 as age_nbs_check_less55YYmore6M_complete
      ,age_nbs_check_less55YYless6MM ,  age_as400_check_less55YYmore6MM + 1 as  age_as400_check_less55YYmore6M_complete
      , age_as400_check_less55YYless6MM , check_birth_year83

     from (
     case when cast(temp_commencement_date_v5 as numeric) > '25550101' 
          then cast(substring(temp_birthdate_v21,1,2 ) as numeric) - cast(substring(temp_commencement_date_v5,1,2  as numeric) as age_nbs_check_more55YY
     when commencement_date_400 > '25550101'
          then cast(substring(cust_birthdate_400,1,2 ) as numeric) - cast(substring(commencement_date_400,1,2 ) as numeric)  as age_as400_check_more55YY
          
     when cast(temp_commencement_date_v5 as numeric) < '25550101' and cast(substring(temp_commencement_date_v5,3,2 ) as numeric) > 6
          then cast(substring(temp_birthdate_v21,1,2 ) as numeric)  - cast(temp_commencement_date_v5 ,1,2 ) as numeric)  as age_nbs_check_less55YYmore6MM 

     when cast(temp_commencement_date_v5 as numeric) < '25550101' and cast(substring(temp_commencement_date_v5,3,2 ) as numeric) < 6
          then cast(substring(temp_birthdate_v21,1,2 ) as numeric) - cast(temp_commencement_date_v5 ,1,2 ) as numeric) as age_nbs_check_less55YYless6MM
          
     when cust_birthdate_400 < '25550101' and cast(substring(cust_birthdate_400,3,2 ) as numeric) > 6
          then cast(substring(cust_birthdate_400,1,2 ) as numeric)  - cast(commencement_date_400 as numeric)  as age_as400_check_less55YYmore6MM 

     when cust_birthdate_400  < '25550101' and cast(substring(cust_birthdate_400,3,2 ) as numeric) < 6
          then cast(substring(cust_birthdate_400,1,2 ) as numeric) - cast(commencement_date_400 as numeric) as age_as400_check_less55YYless6MM
     when cast(substring(commencement_date_400,1,2 ) as numeric) < '83'and 
          cast(substring(cust_birthdate_400,3,2 ) as numeric)||cast(substring(cust_birthdate_400,1,2 ) as numeric) = '0101'
          then 1 else 0 end) as check_birth_year83
       check_birth_nomatch chk)
       

